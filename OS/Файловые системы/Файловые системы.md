## Введение

Компьютеры хранят информацию на различных **носителях вторичной памяти** (secondary storage). Эти устройства, как правило, **энергонезависимы (nonvolatile)**, то есть их содержимое сохраняется даже после перезагрузки системы.

Примеры таких носителей:

- **Устройства NVM (Non-Volatile Memory)**: Например, современные SSD.
    
- **HDD (Hard Disk Drives)**: Традиционные жёсткие диски.
    
- **Магнитные ленты (magnetic tapes)**.
    
- **Оптические диски (optical disks)**: Например, CD, DVD.

Для того чтобы сделать использование компьютерной системы **удобным**, операционная система предоставляет **единый логический взгляд** на всю хранящуюся информацию.
ОС **абстрагируется (abstracts from)** от физических свойств конкретных устройств хранения и определяет **логическую единицу хранения** — **файл (file)**.

В общем смысле, файл — это **последовательность битов, байтов, строк или записей**, **значение** которой определяется **создателем и пользователем** этого файла. Файлы обычно представляют программы (исходный код или исполняемый код) **и данные**.

**Файловая система (ФС)** — это мост между пользователем (или программой) и данными, которые физически хранятся на диске. Её главные задачи:

1. **Скрыть сложность.** Пользователь работает с файлами (открывает, сохраняет), а ФС за кулисами преобразует эти операции в чтение и запись конкретных блоков на диске.
    
2. **Обеспечить единообразие.** Одна и та же программа может работать с файлами на флешке, SSD-диске или в сети, потому что ФС предоставляет стандартный интерфейс.
    
3. **Организовать данные.** ФС ведет учет того, какие блоки диска заняты, какие свободны, где хранятся метаданные файлов (имя, размер, права доступа и т.д.).

## Назначение ФС

![[Pasted image 20251206133656.png]]

- Это создание **стандартизированного набора правил и функций** (API) для работы с данными, независимо от того, как эти данные физически хранятся. **Для всех файловых систем в системе используются одинаковые команды:**  `open`, `read`, `write`, `close`, `mkdir`, `unlink` — и не важно, NTFS это, ext4, флешка или сетевой диск

- Это создание **прослойки** (VFS - Виртуальная Файловая Система) между прикладной программой и драйвером конкретной файловой системы (например, NTFS или ext4).Между программой и реальной файловой системой есть **прокладка-переводчик**, которая скрывает все сложности конкретной FS.

- Это применение единых правил и методов организации данных к **разнообразному** физическому оборудованию.

### Блок
**Блочное устройство:** устройство, которое позволяет читать/писать фиксированные порции данных — _блоки_ (обычно 512B, 4KiB, реже другие размеры). Все операции ввода-вывода (I/O) на уровне физического устройства происходят **блоками**.
ФС настраиваются на разный размер блока (4КБ, 8КБ, 16КБ и т.д.).

- **Маленький блок (4КБ):** Меньше потерь места (меньше внутренней фрагментации), но больше метаданных и более медленная работа с очень большими файлами (нужно считывать много маленьких блоков).
    
- **Большой блок (64КБ):** Быстрая работа с большими файлами (меньше I/O операций), но много потерянного места, если вы храните много маленьких файлов. Выбор размера блока — это всегда **компромисс** между скоростью и эффективностью использования пространства.

### (Virtual File System)

```
Приложение (open/read/write/close)
          ↓ (системный вызов)
        Ядро (syscall dispatcher)
          ↓
         VFS  ←——— единственная входная точка файловых операций
          ↓
  Конкретный драйвер FS (ext4, ntfs, xfs, nfs, fuse...)
          ↓
    Блочное устройство / контроллер диска (HDD/SSD) / сеть

```


## Структура диска

![[Pasted image 20251206133702.png]]
**GPT (GUID Partition Table)** — это современная схема разметки диска.

```
Диск → GPT → Раздел → ext4 → файлы
```

1. **Protective MBR (LBA 0):**
    
    - Это "защитный" элемент для совместимости со старыми системами, которые не понимают GPT. Он сообщает такой системе: "Весь диск занят одним разделом, не трогай его". Это предотвращает повреждение GPT-структур.
        
2. **GPT Header (LBA 1):**
    
    - Это "оглавление" для таблицы разделов. В нем хранится служебная информация: где начинается и заканчивается таблица разделов, её контрольная сумма (для проверки целостности) и уникальный идентификатор диска.
        
3. **Partition Table (LBA 2–33)(128 записей по 128 байт каждая):**
    
    - Это сама **таблица разделов**. Она представляет собой массив записей, где каждый элемент описывает один раздел на диске (например, диск C: или D: в Windows). В каждой записи указано:
        
        - Тип раздела (ESP, Linux FS, Swap, Microsoft Basic Data и т.д.)
        - Уникальный GUID раздела
        - Начальный сектор раздела
        - Конечный сектор раздела
        - Флаги
        - Имя раздела (например: `"EFI System"`, `"Linux root"`)
            
    - Поскольку эта таблица находится в начале диска, её называют **Primary Partition Table**.
4. **Partition 1, 2, 3, 4...:**
    
    - Это сами **разделы диска**, то есть области, отведенные под данные. Именно на этих разделах и создаются файловые системы (например, NTFS, ext4, FAT32).
5. **Backup Partition Entries Array (Резервная таблица разделов)**    

6. Backup GPT Header (Резервный заголовок GPT)
     Разметка дублируется и защищена от повреждений.
     
7. **GPT Disk Layout (вся схема):**
    
    - ключевое преимущество GPT: если основные структуры в начале диска будут повреждены, их можно восстановить из копии в конце.

## Базовые единицы

![[Pasted image 20251206133707.png]]![[Pasted image 20251206133718.png]]
![[Pasted image 20251206133724.png]]![[Pasted image 20251206133729.png]]![[Pasted image 20251206133735.png]]![[Pasted image 20251206133741.png]]![[Pasted image 20251206133751.png]]
![[Pasted image 20251206133807.png]]
![[Pasted image 20251206133816.png]]![[Pasted image 20251206133824.png]]
![[Pasted image 20251206133836.png]]
![[Pasted image 20251206133848.png]]
![[Pasted image 20251206133854.png]]
![[Pasted image 20251206133900.png]]![[Pasted image 20251206133905.png]]
![[Pasted image 20251206133915.png]]![[Pasted image 20251206133921.png]]
![[Pasted image 20251206133925.png]]![[Pasted image 20251206133932.png]]
![[Pasted image 20251206133940.png]]